<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrancheTrack</title>
<link rel="stylesheet" href="assets/style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lexend+Exa:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>
<body>

<div class="app-layout">
  <main class="main-content">
    <div class="container">
      <header>
        <img src="assets/img/logo.png" alt="TrancheTrack" class="logo">
        <div class="header-actions">
          <span class="timestamp" id="lastRefresh">Loading prices…</span>
          <button class="btn-primary" id="refreshBtn" onclick="refreshPrices()">Refresh Prices</button>
          <button onclick="openAddTranche()">+ Add Tranche</button>
          <button onclick="window.location.href='import-export.html'">Import / Export</button>
          <button onclick="toggleSidebar()" id="alertsBtn">Alerts</button>
          <a href="settings.html" class="btn-icon" title="Settings"><i class="fa-solid fa-gear"></i></a>
        </div>
      </header>

      <div id="loadingMsg"></div>

      <!-- Sort / Filter bar -->
      <div class="filter-bar">
        <div class="filter-group">
          <label for="filterTicker">Ticker</label>
          <select id="filterTicker" onchange="applyFilters()">
            <option value="">All</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="sortField">Sort by</label>
          <select id="sortField" onchange="applyFilters()">
            <option value="ticker">Ticker (default)</option>
            <option value="date-desc">Date (newest first)</option>
            <option value="date-asc">Date (oldest first)</option>
            <option value="price-desc">Purchase Price (high to low)</option>
            <option value="price-asc">Purchase Price (low to high)</option>
            <option value="pnl-desc">P&amp;L (best first)</option>
            <option value="pnl-asc">P&amp;L (worst first)</option>
            <option value="alpha-desc">Alpha (highest first)</option>
            <option value="alpha-asc">Alpha (lowest first)</option>
            <option value="days-desc">Days Held (longest first)</option>
            <option value="days-asc">Days Held (shortest first)</option>
          </select>
        </div>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Ticker</th>
              <th>Purchase Date</th>
              <th class="num">Purchase Price</th>
              <th class="num">Shares</th>
              <th class="num">Price Today</th>
              <th class="num">Days Since Trade</th>
              <th class="num">Profit / Loss</th>
              <th class="num">% Profit / Loss</th>
              <th class="num">Ann. % Profit / Loss</th>
              <th class="num">SPY (at Purchase Date)</th>
              <th class="num">SPY (Now)</th>
              <th class="num">SPY % Profit / Loss</th>
              <th class="num">SPY Ann. % P/L</th>
              <th class="num">Ann. Alpha</th>
              <th class="num">Oscillator</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="16" class="no-data">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Alerts Sidebar -->
  <aside class="alerts-sidebar" id="alertsSidebar">
    <div class="sidebar-header">
      <h2>Alerts</h2>
      <button class="sidebar-close" onclick="toggleSidebar()">&times;</button>
    </div>
    <div class="sidebar-tabs" id="alertsTabs"></div>
    <div class="sidebar-content" id="alertsContainer">
      <div class="sidebar-empty">Click <strong>Refresh Prices</strong> to generate alerts.</div>
    </div>
  </aside>
</div>


<!-- Add Tranche Overlay -->
<div class="add-tranche-overlay" id="addTrancheOverlay" onclick="if(event.target===this)closeAddTranche()">
  <div class="add-tranche-panel">
    <h2>Add New Tranche</h2>
    <div class="form-row">
      <label for="inputTicker">Ticker Symbol</label>
      <input type="text" id="inputTicker" placeholder="e.g. AAPL">
    </div>
    <div class="form-row">
      <label for="inputDate">Purchase Date</label>
      <input type="text" id="inputDate" placeholder="MM/DD/YYYY">
    </div>
    <div class="form-row">
      <label for="inputPrice">Purchase Price ($)</label>
      <input type="number" id="inputPrice" step="0.01" placeholder="0.00">
    </div>
    <div class="form-row">
      <label for="inputSpyPrice">SPY Price on Purchase Date ($)</label>
      <input type="number" id="inputSpyPrice" step="0.01" placeholder="0.00">
    </div>
    <div class="form-row">
      <label for="inputShares">Number of Shares <span style="font-size:0.78rem;opacity:0.6">(optional)</span></label>
      <input type="number" id="inputShares" step="0.001" placeholder="Leave blank if unknown">
    </div>
    <div class="form-actions">
      <button onclick="closeAddTranche()">Cancel</button>
      <button class="btn-primary" onclick="addTranche()">Add Tranche</button>
    </div>
  </div>
</div>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<div id="toastContainer" class="toast-container"></div>

<script src="scripts/constants.js"></script>
<script src="scripts/application.js"></script>
</body>
</html>
